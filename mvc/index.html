<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.5e14b1d213128089bc7d.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}

/*! modern-normalize v1.0.0 | MIT License | https://github.com/sindresorhus/modern-normalize */:root{-moz-tab-size:4;-o-tab-size:4;tab-size:4}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}hr{height:0;color:inherit}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}button{-webkit-appearance:button}legend{padding:0}progress{vertical-align:baseline}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:Inter var,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{box-sizing:border-box;border:0 solid #e5e7eb}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#9ca3af}input::placeholder,textarea::placeholder{color:#9ca3af}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}.prose{color:#374151;max-width:65ch}.prose a{color:#111827;text-decoration:underline;font-weight:500}.prose strong{color:#111827;font-weight:600}.prose ol{counter-reset:list-counter;margin-top:1.25em;margin-bottom:1.25em}.prose ol>li{position:relative;counter-increment:list-counter;padding-left:1.75em}.prose ol>li:before{content:counter(list-counter) ".";position:absolute;font-weight:400;color:#6b7280;left:0}.prose ul>li{position:relative;padding-left:1.75em}.prose ul>li:before{content:"";position:absolute;background-color:#d1d5db;border-radius:50%;width:.375em;height:.375em;top:.6875em;left:.25em}.prose hr{border-color:#e5e7eb;border-top-width:1px;margin-top:3em;margin-bottom:3em}.prose blockquote{font-weight:500;font-style:italic;color:#111827;border-left-width:.25rem;border-left-color:#e5e7eb;quotes:"\201C""\201D""\2018""\2019";margin-top:1.6em;margin-bottom:1.6em;padding-left:1em}.prose blockquote p:first-of-type:before{content:open-quote}.prose blockquote p:last-of-type:after{content:close-quote}.prose h1{color:#111827;font-weight:800;font-size:2.25em;margin-top:0;margin-bottom:.8888889em;line-height:1.1111111}.prose h2{color:#111827;font-weight:700;font-size:1.5em;margin-top:2em;margin-bottom:1em;line-height:1.3333333}.prose h3{font-size:1.25em;margin-top:1.6em;margin-bottom:.6em;line-height:1.6}.prose h3,.prose h4{color:#111827;font-weight:600}.prose h4{margin-top:1.5em;margin-bottom:.5em;line-height:1.5}.prose figure figcaption{color:#6b7280;font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose code{color:#111827;font-weight:600;font-size:.875em}.prose code:after,.prose code:before{content:"`"}.prose a code{color:#111827}.prose pre{color:#e5e7eb;background-color:#1f2937;overflow-x:auto;font-size:.875em;line-height:1.7142857;margin-top:1.7142857em;margin-bottom:1.7142857em;border-radius:.375rem;padding:.8571429em 1.1428571em}.prose pre code{background-color:transparent;border-width:0;border-radius:0;padding:0;font-weight:400;color:inherit;font-size:inherit;font-family:inherit;line-height:inherit}.prose pre code:after,.prose pre code:before{content:""}.prose table{width:100%;table-layout:auto;text-align:left;margin-top:2em;margin-bottom:2em;font-size:.875em;line-height:1.7142857}.prose thead{color:#111827;font-weight:600;border-bottom-width:1px;border-bottom-color:#d1d5db}.prose thead th{vertical-align:bottom;padding-right:.5714286em;padding-bottom:.5714286em;padding-left:.5714286em}.prose tbody tr{border-bottom-width:1px;border-bottom-color:#e5e7eb}.prose tbody tr:last-child{border-bottom-width:0}.prose tbody td{vertical-align:top;padding:.5714286em}.prose{font-size:1rem;line-height:1.75}.prose p{margin-top:1.25em;margin-bottom:1.25em}.prose figure,.prose img,.prose video{margin-top:2em;margin-bottom:2em}.prose figure>*{margin-top:0;margin-bottom:0}.prose h2 code{font-size:.875em}.prose h3 code{font-size:.9em}.prose ul{margin-top:1.25em;margin-bottom:1.25em}.prose li{margin-top:.5em;margin-bottom:.5em}.prose>ul>li p{margin-top:.75em;margin-bottom:.75em}.prose>ul>li>:first-child{margin-top:1.25em}.prose>ul>li>:last-child{margin-bottom:1.25em}.prose>ol>li>:first-child{margin-top:1.25em}.prose>ol>li>:last-child{margin-bottom:1.25em}.prose ol ol,.prose ol ul,.prose ul ol,.prose ul ul{margin-top:.75em;margin-bottom:.75em}.prose h2+*,.prose h3+*,.prose h4+*,.prose hr+*{margin-top:0}.prose thead th:first-child{padding-left:0}.prose thead th:last-child{padding-right:0}.prose tbody td:first-child{padding-left:0}.prose tbody td:last-child{padding-right:0}.prose>:first-child{margin-top:0}.prose>:last-child{margin-bottom:0}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem*var(--tw-space-y-reverse))}.space-y-5>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.25rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.25rem*var(--tw-space-y-reverse))}.space-y-6>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem*var(--tw-space-y-reverse))}.space-x-6>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1.5rem*var(--tw-space-x-reverse));margin-left:calc(1.5rem*(1 - var(--tw-space-x-reverse)))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse:0;border-top-width:calc(1px*(1 - var(--tw-divide-y-reverse)));border-bottom-width:calc(1px*var(--tw-divide-y-reverse))}.divide-gray-200>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgba(229,231,235,var(--tw-divide-opacity))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.rounded-full{border-radius:9999px}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.table{display:table}.hidden{display:none}.flex-row{flex-direction:row}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.font-medium{font-weight:500}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-10{height:2.5rem}.text-base{font-size:1rem;line-height:1.5rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.leading-6{line-height:1.5rem}.leading-8{line-height:2rem}.leading-9{line-height:2.25rem}.mx-auto{margin-left:auto;margin-right:auto}.mr-1{margin-right:.25rem}.ml-1{margin-left:.25rem}.mr-3{margin-right:.75rem}.ml-3{margin-left:.75rem}.max-w-none{max-width:none}.max-w-3xl{max-width:48rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-8{padding-top:2rem;padding-bottom:2rem}.py-12{padding-top:3rem;padding-bottom:3rem}.pt-8{padding-top:2rem}.pb-12{padding-bottom:3rem}.pt-14{padding-top:3.5rem}*{--tw-shadow:0 0 transparent;--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,0.5);--tw-ring-offset-shadow:0 0 transparent;--tw-ring-shadow:0 0 transparent}.text-gray-500{--tw-text-opacity:1;color:rgba(107,114,128,var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgba(31,41,55,var(--tw-text-opacity))}.text-blue-600{--tw-text-opacity:1;color:rgba(37,99,235,var(--tw-text-opacity))}.hover\:text-blue-400:hover{--tw-text-opacity:1;color:rgba(96,165,250,var(--tw-text-opacity))}.no-underline{text-decoration:none}.hover\:underline:hover{text-decoration:underline}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.tracking-tight{letter-spacing:-.025em}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-10{width:2.5rem}.w-full{width:100%}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{transform:scale(2);opacity:0}}@keyframes ping{75%,to{transform:scale(2);opacity:0}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}@keyframes bounce{0%,to{transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1)}}:not(pre)>code[class*=language-]{padding:0;border-radius:0;white-space:normal;background:none}@media (min-width:640px){.sm\:block{display:block}.sm\:text-2xl{font-size:1.5rem;line-height:2rem}.sm\:text-4xl{font-size:2.25rem}.sm\:leading-10,.sm\:text-4xl{line-height:2.5rem}.sm\:px-8{padding-left:2rem;padding-right:2rem}.sm\:py-10{padding-top:2.5rem;padding-bottom:2.5rem}.sm\:w-1\/2{width:50%}}@media (min-width:768px){.md\:text-5xl{font-size:3rem;line-height:1}.md\:px-12{padding-left:3rem;padding-right:3rem}}@media (min-width:1024px){.lg\:px-0{padding-left:0;padding-right:0}}</style><meta name="generator" content="Gatsby 2.30.0"/><title data-react-helmet="true">My Todo MVC | David Valles</title><link data-react-helmet="true" rel="stylesheet" href="https://rsms.me/inter/inter.css"/><meta data-react-helmet="true" name="lang" content="en"/><meta data-react-helmet="true" name="description" content="My notes on building an app following the MVC pattern."/><meta data-react-helmet="true" property="og:url" content="https://dtjv.io/mvc/"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="My Todo MVC | David Valles"/><meta data-react-helmet="true" property="og:description" content="My notes on building an app following the MVC pattern."/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="My Todo MVC | David Valles"/><meta data-react-helmet="true" name="twitter:description" content="My notes on building an app following the MVC pattern."/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=3ae3edfa276008c055ba1782c0cc2373" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#3b82f6"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link as="script" rel="preload" href="/webpack-runtime-60af3e6e4bbc361935ad.js"/><link as="script" rel="preload" href="/styles-bc72ca78f9bad9fb1f45.js"/><link as="script" rel="preload" href="/framework-5e01c8af6b1735c9eaa3.js"/><link as="script" rel="preload" href="/app-dc7983e485fe83bd2768.js"/><link as="script" rel="preload" href="/commons-c5263a5a27357713cd50.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-1e69e29a54ce029a9b80.js"/><link as="fetch" rel="preload" href="/page-data/mvc/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3764592887.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="max-w-3xl px-5 mx-auto antialiased sm:px-8 md:px-12 lg:px-0"><nav><div class="flex items-center justify-between py-8 text-gray-800"><a aria-label="link to home page" href="/"><div class="flex flex-row items-center"><img class="block w-10 h-10 mr-3 rounded-full" src="/static/me-8883eb01644c20ae8746a0d58d90a29a.jpg" alt="pic of david"/><span class="text-xl font-extrabold">David Valles</span></div></a><a class="font-bold text-gray-500 text-normal hover:underline" href="/projects">Projects</a></div></nav><main><div class="py-8 sm:py-10"><article><header class="space-y-2"><dl><dt class="sr-only">Published on</dt><dd class="text-base font-medium text-gray-500 leading-6"><time dateTime="Tue Feb 09 2021 20:28:27 GMT-0800 (Pacific Standard Time)">February 02, 2021</time></dd></dl><div><h1 class=" text-3xl font-extrabold tracking-tight text-gray-800 leading-9 sm:leading-10 sm:text-4xl md:text-5xl md:leading-14">My Todo MVC</h1><p class="text-2xl tracking-tight text-gray-500 pt-14">My notes on building an app following the MVC pattern.</p></div></header><div class="pt-8 pb-12 prose max-w-none"><p>Today, modern web applications use some flavor of the
<a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC pattern</a>
with the aid of a
<a href="https://developer.mozilla.org/en-US/docs/Learn/Tools_and_testing/Client-side_JavaScript_frameworks/Introduction">client-side framework</a>.
Having missed the pre-frontend framework era, I asked myself if I <em>really</em>
understood this foundational pattern? To answer this question, I decided to
build an app that adhered to the basic premise of MVC. This article discusses
key points of my implementation.</p>
<!-- more -->
<ul>
<li>View the <a href="https://dtjv.io/mvc.ts">demo</a>.</li>
<li>View the <a href="https://github.com/dtjv/mvc.ts">source code</a>.</li>
</ul>
<h2>MVC Basics</h2>
<p>The MVC pattern describes a way to split an application into areas of concern
and how these areas relate to each other. The areas of concern include the data
Model, the View and the Controller.</p>
<h3>Model</h3>
<p>The Model represents the application data and the functionality to manage that
data. It maintains data integrity by ensuring data creation and modification
abide by the application rules. The Model is unaware of any other component in
the system.</p>
<h3>View</h3>
<p>The View provides a visual representation of the application data. To a degree,
the View must know about the Model. To what degree this knowledge exists depends
on the flavor of the MVC pattern used.</p>
<h3>Controller</h3>
<p>In the <em>traditional</em> version, the Controller encapsulates all business logic and
orchestrates communication between the Model, the View and any other components
added to the mix. Altnernative implementations of the MVC pattern diminish the
Controller's role and off-loading functionality to other components.</p>
<h2>Questions</h2>
<p>The high-level descriptions in the previous section lack clarity on real world
implementation details. As I began to sketch out a rough design for my app, the
following questions came to mind.</p>
<ul>
<li>How does the application start?</li>
<li>Who retrieves initial data?</li>
<li>How does data get into the Model?</li>
<li>How does the View get access to data?</li>
<li>How does user interaction change the Model data?</li>
<li>Should the View handle user interaction?</li>
<li>Should the View update the Model?</li>
<li>Should the Model persist data?</li>
<li>What is the difference between the Model and application state?</li>
</ul>
<p>For these implementational details, there are no definitive right or wrong
answers. I realized I needed to choose a direction and build.</p>
<h2>Version 1</h2>
<p>In this first version of my todo app, I pass instances of the View, Model and
Store <em>(yes, a new component - disccussed below)</em> components into the
Controller. The Controller manages data retrieval, data persistence, and
communication between components.</p>
<p>Below shows the application construction.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// index.ts</span>
<span class="token keyword">const</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>document<span class="token punctuation">,</span> <span class="token string">'#app'</span><span class="token punctuation">)</span> <span class="token comment">// View</span>
<span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Todos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Model</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Store</span><span class="token punctuation">(</span><span class="token string">'todos1'</span><span class="token punctuation">,</span> localStorage<span class="token punctuation">)</span> <span class="token comment">// Store</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> view<span class="token punctuation">,</span> store<span class="token punctuation">)</span> <span class="token comment">// Controller</span>

app<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<h3>Model</h3>
<p>In this version, a Todo is a type definition - not a class. The Todos <em>(note the
plural 's')</em> class is the application Model and is dead simple, focusing on
creating and managing the in-memory storage of all Todo objects.</p>
<h3>View</h3>
<p>The View renders all Todo objects that are in memory. The View knows about the
Model structure - that is, it knows the Todo properties to render, but it
doesn't communicate to or change the Model. When a user performs an action, the
View executes registered event handlers associated with that user action. Those
handlers are Controller methods.</p>
<h3>Controller</h3>
<p>Again, the Controller orchestrates the app's activities. For example, the code
snippet below is a Controller event handler that executes when a user clicks on
the <code class="language-text">Add Task</code> button and triggers the View to emit an event to create a todo.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// app.ts (aka the Controller)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>

  <span class="token comment">// 1. tell Model to create and insert a new Todo</span>
  <span class="token comment">// 2. persist the Model</span>
  <span class="token comment">// 3. message the View to update</span>
  <span class="token function">handleCreateTodo</span><span class="token punctuation">(</span>props<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>Todo<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> task<span class="token operator">:</span> props<span class="token punctuation">.</span>task <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>To keep the View decoupled from the Controller, all registered handlers for View
events must have the same generalized function signature. (See below).</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">Handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>Todo<span class="token operator">></span><span class="token punctuation">,</span> event<span class="token operator">?</span><span class="token operator">:</span> Event<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span></code></pre></div>
<h3>Store</h3>
<p>I also introduce a separate component responsible for data persistence. This
design isolates the implementational details of a specific storage system. The
code snippet below shows the Store class implemented for
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"><code class="language-text">Window.localStorage</code></a>.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Store</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token keyword">private</span> <span class="token keyword">readonly</span> db<span class="token operator">:</span> Storage<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">'[]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">set</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>In the current design, the Controller makes calls directly to the Store to save
and retrieve data. You'll notice the Store retrieves <strong>all</strong> the data into
memory at once. This begs the question <em>"What happens when the data amount
exceeds memory capacity or exceeds storage limits?"</em></p>
<p>One solution could be to use pagination and store the data across key indices
(assuming the storage limit was per key and not the whole database).</p>
<p>In the event the app exceeded the whole storage limit, I'd need to write a new
Store class that used a different database <strong>and</strong> change the Controller based
on how I built the Store. The need to swap data stores is not out of the
ordinary, but requiring other code to change to make the swap is not a great
design. To ease this transition, the Store and the Controller should communicate
by a contract defined by an interface. As it stands right now, the Controller
and the Store are too tightly coupled - a limitation I'll need to fix at another
time.</p>
<h2>Version 2</h2>
<p>In version 2, the application construction remains the same as version 1 - save
for one small change to the View constructor. I'll discuss all the underlying
changes next.</p>
<h3>Emitter</h3>
<p>First, I introduce an Emitter class that gives a subclass the ability to call
functions listening to any event that subclass emits.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Emitter</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> listeners<span class="token operator">:</span> Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> Listener<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">addListener</span><span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> listener<span class="token operator">:</span> Listener<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> listeners <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> listeners<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">emit</span><span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> listeners <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>Models</h3>
<p>The Models are more robust in this version. A Todo is now a class implementation
that encapsulates Todo construction and modifications. The Todos <em>(note the
plural 's')</em>, class manages the collection of all Todo instances. Both classes,
collectively called the Model, subclass Emitter and emit a <code class="language-text">CHANGE</code> event when
their internal data change.</p>
<p>The snippet below illustrates the Model event system. Here, the Todo exposes a
<code class="language-text">toggle()</code> method to change the internal state of a Todo. Once changed, the Todo
will execute all functions listening on the <code class="language-text">CHANGE</code> event.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Todo</span> <span class="token keyword">extends</span> <span class="token class-name">Emitter</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> _done<span class="token operator">:</span> <span class="token builtin">boolean</span>

  <span class="token comment">// 1. flip the `_done` property</span>
  <span class="token comment">// 2. call listeners function registered to the `CHANGE` event</span>
  <span class="token keyword">public</span> <span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_done <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_done
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>TodoEvents<span class="token punctuation">.</span><span class="token constant">CHANGE</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>View</h3>
<p>The View is now injected with the Model at application start-up. User
interaction captured by the View triggers the View to update the Model. With the
Model event system in place, any Model change will trigger listener functions to
run.</p>
<h3>Controller</h3>
<p>In this version, the Controller is simple and limited to application setup, data
persistence and messaging the view. Below is the entire Controller class.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// app.ts (aka the Controller)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> _todos<span class="token operator">:</span> Todos<span class="token punctuation">,</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> _view<span class="token operator">:</span> View<span class="token punctuation">,</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> _store<span class="token operator">:</span> Store
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// setup:</span>
    <span class="token comment">// 1. load data into the Model</span>
    <span class="token comment">// 2. register a function to run when the Model changes</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_todos<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>TodoEvents<span class="token punctuation">.</span><span class="token constant">CHANGE</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_onChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_store<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_todos<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span>todo <span class="token keyword">as</span> Todo<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_view<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function">_save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_store<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_todos<span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// called when the Model changes:</span>
  <span class="token comment">// 1. save the Model</span>
  <span class="token comment">// 2. update the View</span>
  <span class="token keyword">private</span> <span class="token function">_onChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>Final Thoughts</h2>
<p>The high-level concept of MVC is easy to grasp and can indeed be trivially
implemented. Although the Todo MVC app is now a cliché, this project was a great
exercise in exploring the nuances of the MVC pattern, in making design decisions
in the face of uncertainty and building with TypeScript and the DOM.</p></div></article></div></main><footer><div class="py-8 sm:py-10"><div class="flex items-center justify-center"><a href="https://github.com/dtjv"><svg role="img" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="w-6 h-6 ml-3 text-color-800"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg></a></div></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/mvc/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-9e9c796164da25fa8bfb.js"],"app":["/app-dc7983e485fe83bd2768.js"],"component---src-pages-404-js":["/component---src-pages-404-js-8c5bf063f636886ee247.js"],"component---src-pages-index-js":["/component---src-pages-index-js-8db2888ddab84e5a5057.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-ea5974847cf6d4ef2f7d.js"],"component---src-templates-post-js":["/component---src-templates-post-js-1e69e29a54ce029a9b80.js"]};/*]]>*/</script><script src="/polyfill-9e9c796164da25fa8bfb.js" nomodule=""></script><script src="/component---src-templates-post-js-1e69e29a54ce029a9b80.js" async=""></script><script src="/commons-c5263a5a27357713cd50.js" async=""></script><script src="/app-dc7983e485fe83bd2768.js" async=""></script><script src="/framework-5e01c8af6b1735c9eaa3.js" async=""></script><script src="/styles-bc72ca78f9bad9fb1f45.js" async=""></script><script src="/webpack-runtime-60af3e6e4bbc361935ad.js" async=""></script></body></html>