<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.b7ac9dcf06fd81b0393a.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}

/*! tailwindcss v2.2.9 | MIT License | https://tailwindcss.com */

/*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */html{-webkit-text-size-adjust:100%;line-height:1.15;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;margin:0}hr{color:inherit;height:0}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}button{-webkit-appearance:button}legend{padding:0}progress{vertical-align:baseline}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:Inter var,ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{border:0 solid;box-sizing:border-box}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{color:inherit;line-height:inherit;padding:0}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]{display:none}*,:after,:before{--tw-border-opacity:1;border-color:rgba(229,231,235,var(--tw-border-opacity))}.prose{color:#374151;max-width:65ch}.prose [class~=lead]{color:#4b5563;font-size:1.25em;line-height:1.6;margin-bottom:1.2em;margin-top:1.2em}.prose a{color:#111827;font-weight:500;text-decoration:underline}.prose strong{color:#111827;font-weight:600}.prose ol>li{padding-left:1.75em;position:relative}.prose ol>li:before{color:#6b7280;content:counter(list-item,var(--list-counter-style,decimal)) ".";font-weight:400;left:0;position:absolute}.prose ul>li{padding-left:1.75em;position:relative}.prose ul>li:before{background-color:#d1d5db;border-radius:50%;content:"";height:.375em;left:.25em;position:absolute;top:.6875em;width:.375em}.prose hr{border-color:#e5e7eb;border-top-width:1px;margin-bottom:3em;margin-top:3em}.prose blockquote{border-left-color:#e5e7eb;border-left-width:.25rem;color:#111827;font-style:italic;font-weight:500;margin-bottom:1.6em;margin-top:1.6em;padding-left:1em;quotes:"\201C""\201D""\2018""\2019"}.prose blockquote p:first-of-type:before{content:open-quote}.prose blockquote p:last-of-type:after{content:close-quote}.prose h1{color:#111827;font-size:2.25em;font-weight:800;line-height:1.1111111;margin-bottom:.8888889em;margin-top:0}.prose h2{color:#111827;font-size:1.5em;font-weight:700;line-height:1.3333333;margin-bottom:1em;margin-top:2em}.prose h3{font-size:1.25em;line-height:1.6;margin-bottom:.6em;margin-top:1.6em}.prose h3,.prose h4{color:#111827;font-weight:600}.prose h4{line-height:1.5;margin-bottom:.5em;margin-top:1.5em}.prose figure figcaption{color:#6b7280;font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose code{color:#111827;font-size:.875em;font-weight:600}.prose code:after,.prose code:before{content:"`"}.prose a code{color:#111827}.prose pre{background-color:#1f2937;border-radius:.375rem;color:#e5e7eb;font-size:.875em;line-height:1.7142857;margin-bottom:1.7142857em;margin-top:1.7142857em;overflow-x:auto;padding:.8571429em 1.1428571em}.prose pre code{background-color:transparent;border-radius:0;border-width:0;color:inherit;font-family:inherit;font-size:inherit;font-weight:400;line-height:inherit;padding:0}.prose pre code:after,.prose pre code:before{content:none}.prose table{font-size:.875em;line-height:1.7142857;margin-bottom:2em;margin-top:2em;table-layout:auto;text-align:left;width:100%}.prose thead{border-bottom-color:#d1d5db;border-bottom-width:1px;color:#111827;font-weight:600}.prose thead th{padding-bottom:.5714286em;padding-left:.5714286em;padding-right:.5714286em;vertical-align:bottom}.prose tbody tr{border-bottom-color:#e5e7eb;border-bottom-width:1px}.prose tbody tr:last-child{border-bottom-width:0}.prose tbody td{padding:.5714286em;vertical-align:top}.prose{font-size:1rem;line-height:1.75}.prose p{margin-bottom:1.25em;margin-top:1.25em}.prose figure,.prose img,.prose video{margin-bottom:2em;margin-top:2em}.prose figure>*{margin-bottom:0;margin-top:0}.prose h2 code{font-size:.875em}.prose h3 code{font-size:.9em}.prose ol,.prose ul{margin-bottom:1.25em;margin-top:1.25em}.prose li{margin-bottom:.5em;margin-top:.5em}.prose>ul>li p{margin-bottom:.75em;margin-top:.75em}.prose>ul>li>:first-child{margin-top:1.25em}.prose>ul>li>:last-child{margin-bottom:1.25em}.prose>ol>li>:first-child{margin-top:1.25em}.prose>ol>li>:last-child{margin-bottom:1.25em}.prose ol ol,.prose ol ul,.prose ul ol,.prose ul ul{margin-bottom:.75em;margin-top:.75em}.prose h2+*,.prose h3+*,.prose h4+*,.prose hr+*{margin-top:0}.prose thead th:first-child{padding-left:0}.prose thead th:last-child{padding-right:0}.prose tbody td:first-child{padding-left:0}.prose tbody td:last-child{padding-right:0}.prose>:first-child{margin-top:0}.prose>:last-child{margin-bottom:0}.sr-only{clip:rect(0,0,0,0);border-width:0;height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{bottom:0;left:0;right:0;top:0}.right-0{right:0}.bottom-0{bottom:0}.z-40{z-index:40}.m-6{margin:1.5rem}.mx-auto{margin-left:auto;margin-right:auto}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.mt-12{margin-top:3rem}.mr-1{margin-right:.25rem}.mr-3{margin-right:.75rem}.mr-32{margin-right:8rem}.ml-1{margin-left:.25rem}.ml-3{margin-left:.75rem}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.table{display:table}.grid{display:grid}.hidden{display:none}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-10{height:2.5rem}.h-full{height:100%}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-10{width:2.5rem}.w-full{width:100%}.max-w-none{max-width:none}.max-w-3xl{max-width:48rem}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{opacity:0;transform:scale(2)}}@keyframes ping{75%,to{opacity:0;transform:scale(2)}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1);transform:translateY(-25%)}50%{-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);transform:none}}@keyframes bounce{0%,to{-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1);transform:translateY(-25%)}50%{-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);transform:none}}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.items-center{align-items:center}.items-baseline{align-items:baseline}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-4{gap:1rem}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(.5rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(.5rem*var(--tw-space-x-reverse))}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(1rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(1rem*var(--tw-space-x-reverse))}.space-x-6>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(1.5rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(1.5rem*var(--tw-space-x-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(.5rem*var(--tw-space-y-reverse));margin-top:calc(.5rem*(1 - var(--tw-space-y-reverse)))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(1rem*var(--tw-space-y-reverse));margin-top:calc(1rem*(1 - var(--tw-space-y-reverse)))}.space-y-5>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(1.25rem*var(--tw-space-y-reverse));margin-top:calc(1.25rem*(1 - var(--tw-space-y-reverse)))}.space-y-6>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(1.5rem*var(--tw-space-y-reverse));margin-top:calc(1.5rem*(1 - var(--tw-space-y-reverse)))}.divide-y>:not([hidden])~:not([hidden]){--tw-divide-y-reverse:0;border-bottom-width:calc(1px*var(--tw-divide-y-reverse));border-top-width:calc(1px*(1 - var(--tw-divide-y-reverse)))}.divide-gray-200>:not([hidden])~:not([hidden]){--tw-divide-opacity:1;border-color:rgba(229,231,235,var(--tw-divide-opacity))}.rounded-lg{border-radius:.5rem}.rounded-full{border-radius:9999px}.border{border-width:1px}.border-b{border-bottom-width:1px}.bg-black{--tw-bg-opacity:1;background-color:rgba(0,0,0,var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.bg-opacity-25{--tw-bg-opacity:0.25}.p-4{padding:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.py-6{padding-bottom:1.5rem;padding-top:1.5rem}.py-8{padding-bottom:2rem;padding-top:2rem}.py-12{padding-bottom:3rem;padding-top:3rem}.pt-8{padding-top:2rem}.pt-14{padding-top:3.5rem}.pb-12{padding-bottom:3rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-base{font-size:1rem;line-height:1.5rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.font-medium{font-weight:500}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.leading-6{line-height:1.5rem}.leading-8{line-height:2rem}.leading-9{line-height:2.25rem}.tracking-tight{letter-spacing:-.025em}.text-white{--tw-text-opacity:1;color:rgba(255,255,255,var(--tw-text-opacity))}.text-gray-500{--tw-text-opacity:1;color:rgba(107,114,128,var(--tw-text-opacity))}.text-gray-600{--tw-text-opacity:1;color:rgba(75,85,99,var(--tw-text-opacity))}.text-gray-800{--tw-text-opacity:1;color:rgba(31,41,55,var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity:1;color:rgba(17,24,39,var(--tw-text-opacity))}.text-blue-600{--tw-text-opacity:1;color:rgba(37,99,235,var(--tw-text-opacity))}.text-chakraui{--tw-text-opacity:1;color:rgba(49,151,149,var(--tw-text-opacity))}.text-email{--tw-text-opacity:1;color:rgba(24,23,23,var(--tw-text-opacity))}.text-firebase{--tw-text-opacity:1;color:rgba(255,202,40,var(--tw-text-opacity))}.text-forestry{--tw-text-opacity:1;color:rgba(52,58,64,var(--tw-text-opacity))}.text-gatsby{--tw-text-opacity:1;color:rgba(102,51,153,var(--tw-text-opacity))}.text-github{--tw-text-opacity:1;color:rgba(24,23,23,var(--tw-text-opacity))}.text-gsheets{--tw-text-opacity:1;color:rgba(52,168,83,var(--tw-text-opacity))}.text-js{--tw-text-opacity:1;color:rgba(247,223,30,var(--tw-text-opacity))}.text-jekyll{--tw-text-opacity:1;color:rgba(204,0,0,var(--tw-text-opacity))}.text-jquery{--tw-text-opacity:1;color:rgba(7,105,173,var(--tw-text-opacity))}.text-mongodb{--tw-text-opacity:1;color:rgba(71,162,72,var(--tw-text-opacity))}.text-netlify{--tw-text-opacity:1;color:rgba(0,199,183,var(--tw-text-opacity))}.text-nextjs{--tw-text-opacity:1;color:rgba(0,0,0,var(--tw-text-opacity))}.text-postcss{--tw-text-opacity:1;color:rgba(221,58,10,var(--tw-text-opacity))}.text-pug{--tw-text-opacity:1;color:rgba(168,100,84,var(--tw-text-opacity))}.text-react{--tw-text-opacity:1;color:rgba(97,218,251,var(--tw-text-opacity))}.text-reactrouter{--tw-text-opacity:1;color:rgba(202,66,69,var(--tw-text-opacity))}.text-sass{--tw-text-opacity:1;color:rgba(204,102,153,var(--tw-text-opacity))}.text-tailwind{--tw-text-opacity:1;color:rgba(56,178,172,var(--tw-text-opacity))}.text-ts{--tw-text-opacity:1;color:rgba(49,120,198,var(--tw-text-opacity))}.text-twitter{--tw-text-opacity:1;color:rgba(24,23,23,var(--tw-text-opacity))}.text-vercel{--tw-text-opacity:1;color:rgba(0,0,0,var(--tw-text-opacity))}.hover\:text-blue-400:hover{--tw-text-opacity:1;color:rgba(96,165,250,var(--tw-text-opacity))}.no-underline{text-decoration:none}.hover\:underline:hover{text-decoration:underline}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*,:after,:before{--tw-shadow:0 0 #0000}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}*,:after,:before{--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000}.filter{--tw-blur:var(--tw-empty,/*!*/ /*!*/);--tw-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-invert:var(--tw-empty,/*!*/ /*!*/);--tw-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-drop-shadow:var(--tw-empty,/*!*/ /*!*/);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}:not(pre)>code[class*=language-]{background:none;border-radius:0;padding:0;white-space:normal}code[class*=language-],pre[class*=language-]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.gatsby-code-title+.gatsby-highlight>pre[class*=language-]{border-top-left-radius:0;border-top-right-radius:0;margin-top:0}.gatsby-code-title{--tw-bg-opacity:1;--tw-text-opacity:1;background-color:rgba(17,24,39,var(--tw-bg-opacity));border-top-left-radius:.375rem;border-top-right-radius:.375rem;color:rgba(229,231,235,var(--tw-text-opacity));font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:.875rem;line-height:1.25rem;padding:1rem}@media (min-width:640px){.sm\:flex{display:flex}.sm\:hidden{display:none}.sm\:w-1\/2{width:50%}.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.sm\:flex-col{flex-direction:column}.sm\:px-8{padding-left:2rem;padding-right:2rem}.sm\:py-10{padding-bottom:2.5rem;padding-top:2.5rem}.sm\:text-2xl{font-size:1.5rem;line-height:2rem}.sm\:text-4xl{font-size:2.25rem}.sm\:leading-10,.sm\:text-4xl{line-height:2.5rem}}@media (min-width:768px){.md\:px-12{padding-left:3rem;padding-right:3rem}.md\:text-5xl{font-size:3rem;line-height:1}}@media (min-width:1024px){.lg\:px-0{padding-left:0;padding-right:0}}</style><meta name="generator" content="Gatsby 3.12.1"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true">Data validation with Superstruct | David Valles</title><link data-react-helmet="true" rel="stylesheet" href="https://rsms.me/inter/inter.css"/><meta data-react-helmet="true" name="lang" content="en"/><meta data-react-helmet="true" name="description" content="A personal website by David Valles."/><meta data-react-helmet="true" property="og:url" content="https://dtjv.io/data-validation-with-superstruct/"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Data validation with Superstruct | David Valles"/><meta data-react-helmet="true" property="og:description" content="A personal website by David Valles."/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Data validation with Superstruct | David Valles"/><meta data-react-helmet="true" name="twitter:description" content="A personal website by David Valles."/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="icon" href="/favicon-32x32.png?v=3ae3edfa276008c055ba1782c0cc2373" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#3b82f6"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=3ae3edfa276008c055ba1782c0cc2373"/><link as="script" rel="preload" href="/webpack-runtime-e71aa90cd4d05079cfbc.js"/><link as="script" rel="preload" href="/framework-fea831110b03277f031d.js"/><link as="script" rel="preload" href="/app-cc3205a19653bf75719c.js"/><link as="script" rel="preload" href="/commons-15d545375be859768d92.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-d78a8d412a346317d064.js"/><link as="fetch" rel="preload" href="/page-data/data-validation-with-superstruct/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3764592887.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="relative"><div class="hidden inset-0 z-40 h-full bg-black w-full bg-opacity-25"><div class="h-full px-5 mx-auto mr-32 antialiased bg-white sm:px-8 md:px-12 lg:px-0"><div class="py-8 sm:py-10 flex flex-col space-y-4"><a class="font-bold text-gray-500 text-normal hover:underline" href="/articles">Articles</a><a class="font-bold text-gray-500 text-normal hover:underline" href="/projects">Projects</a></div></div><div class="absolute bottom-0 right-0 p-4 m-6 text-white bg-black rounded-full"><svg class="w-6 h-6" role="img" fill="currentColor" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></div></div><div class="max-w-3xl px-5 mx-auto antialiased sm:px-8 md:px-12 lg:px-0 "><nav><div class="flex items-center border-b justify-between py-8 text-gray-800"><a aria-label="link to home page" href="/"><div class="flex flex-row items-center"><img class="block w-10 h-10 mr-3 rounded-full" src="/static/me-489bf93d5ea946eaa86b52a1a34dc8d4.jpg" alt="pic of david"/><span class="text-xl font-extrabold">David Valles</span></div></a><svg class="w-6 h-6 sm:hidden" role="img" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path></svg><div class="hidden sm:flex space-x-4"><a class="font-bold text-gray-500 text-normal hover:underline" href="/projects">Projects</a><a href="https://github.com/dtjv"><svg class="text-github w-6 h-6 ml-3 text-color-800 hover:text-blue-400" role="img" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a></div></div></nav><main><div class="py-8 sm:py-10 "><article><header class="space-y-2"><dl><dt class="sr-only">Published on</dt><dd class="text-base font-medium text-gray-500 leading-6"><time dateTime="Tue Sep 21 2021 09:03:29 GMT-0700 (Pacific Daylight Time)">August 05, 2021</time></dd></dl><div><h1 class=" text-3xl font-extrabold tracking-tight text-gray-800 leading-9 sm:leading-10 sm:text-4xl md:text-5xl md:leading-14">Data validation with Superstruct</h1></div></header><div class="py-12 prose max-w-none"><p>I came across <a href="https://docs.superstructjs.org/">Superstruct</a> from the
<a href="https://react-hook-form.com/">React Hook Form</a> documentation - in particular
the <a href="https://react-hook-form.com/get-started#SchemaValidation">schema-based</a>
form validation. Since I wasn&#x27;t thrilled about burying form field validation
logic inside JSX, I choose to use Superstruct. In this short post, I&#x27;ll walk
through an example of how to use Superstruct for simple to slightly more complex
data validation.</p><ul><li>View the
<a href="https://github.com/dtjv/blog-demos/tree/main/data-validation-with-superstruct">source code</a>.</li></ul><h2>Superstruct Schema</h2><p>Superstruct provides an intuitive API to define the shape of your application
data and functions to validate that data at runtime. You can compose type
annotations and utility functions to build complex data structures and more
refined data validation checks.</p><blockquote><p>In Superstruct parlance, the <code class="language-text">Struct</code> is the data structure created and
returned by Superstruct utilities. In this post, I use <code class="language-text">Schema</code> in place of
<code class="language-text">Struct</code>.</p></blockquote><p>We start by creating a schema to describe our data.</p><div class="gatsby-code-title">index.ts</div><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ss <span class="token keyword">from</span> <span class="token string">&#x27;superstruct&#x27;</span>

<span class="token keyword">const</span> PersonSchema <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div><p>Next, we add a data object and validation logic.</p><div class="gatsby-code-title">index.ts</div><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// ...snipped for brevity...</span>

<span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&#x27;joe&#x27;</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">&#x27;admin&#x27;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

ss<span class="token punctuation">.</span><span class="token keyword">is</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> PersonSchema<span class="token punctuation">)</span> <span class="token comment">// returns true</span></code></pre></div><p>Okay, we&#x27;ve got a working example. In the next sections, we&#x27;ll add TypeScript
types to our data object and tighten up validation for <code class="language-text">name</code> and <code class="language-text">password</code>
properties.</p><h2>TypeScript Types</h2><p>One option to type our data object is to create an interface.</p><div class="gatsby-code-title">index.ts</div><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// ...snipped for brevity...</span>

<span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
  password<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> person<span class="token operator">:</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&#x27;joe&#x27;</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">&#x27;admin&#x27;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div><p>The downside to the approach above is the duplication of defining a schema <em>and</em>
a TypeScript interface. Depending on your project structure and data complexity,
keeping the two in sync might become a burden to maintain.</p><p>The good news is Superstruct provides the <code class="language-text">Infer</code> utility to derive TypeScript
types from a Superstruct schema. We can replace our interface definition with
the following line.</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token operator">=</span> ss<span class="token punctuation">.</span>Infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> PersonSchema<span class="token operator">&gt;</span></code></pre></div><h2>Data Validation</h2><p>Our example thus far validates <code class="language-text">name</code> and <code class="language-text">password</code> as type string - which is a
bit too broad. Let&#x27;s refine the types by composing Superstruct&#x27;s utilities.</p><div class="gatsby-code-title">index.ts</div><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ss <span class="token keyword">from</span> <span class="token string">&#x27;superstruct&#x27;</span>

<span class="token keyword">const</span> <span class="token function-variable function">alphanum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ss<span class="token punctuation">.</span><span class="token function">pattern</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[a-zA-Z0-9]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">password</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ss<span class="token punctuation">.</span><span class="token function">pattern</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-zA-Z0-9*:?]{3,6}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>

<span class="token keyword">const</span> PersonSchema <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">defaulted</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token function">alphanum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#x27;admin&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token function">password</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token operator">=</span> ss<span class="token punctuation">.</span>Infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> PersonSchema<span class="token operator">&gt;</span>

<span class="token keyword">const</span> admin<span class="token operator">:</span> Pick<span class="token operator">&lt;</span>Person<span class="token punctuation">,</span> <span class="token string">&#x27;password&#x27;</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span> Partial<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  password<span class="token operator">:</span> <span class="token string">&#x27;?g4Lxx&#x27;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> admin<span class="token punctuation">]</span> <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> PersonSchema<span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>admin<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div><p>In the snippet above, <code class="language-text">alphanum</code> and <code class="language-text">password</code> are custom validation functions
that compose Superstruct&#x27;s <code class="language-text">pattern</code> and <code class="language-text">string</code> utilities. The <code class="language-text">PersonSchema</code>
further refines the <code class="language-text">name</code> property to a length between 3 and 30 characters and
sets a default value if <code class="language-text">name</code> is not provided.</p><p>The use of Superstruct&#x27;s <code class="language-text">defaulted</code> utility implies that <code class="language-text">name</code> is optional.
Superstruct&#x27;s <code class="language-text">Infer</code> utility does not recognize this nuance and creates the
<code class="language-text">Person</code> type with <code class="language-text">name</code> required. As a result, I&#x27;ve typed the <code class="language-text">admin</code> data
object in a way to make <code class="language-text">password</code> required and <code class="language-text">name</code> optional.</p><p>If we run the code above, the <code class="language-text">validate</code> function will fail, returning the
following error.</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">StructError: At path: name -- Expected a string, but received: undefined {
  value: undefined,
  type: &#x27;string&#x27;,
  refinement: undefined,
  key: &#x27;name&#x27;,
  path: [ &#x27;name&#x27; ],
  branch: [ { password: &#x27;?g4Lxx&#x27; }, undefined ],
  failures: [Function (anonymous)]
}</code></pre></div><p>This error is due to the <code class="language-text">defaulted</code> function not executing. The <code class="language-text">defaulted</code>
function is a <em>coerce</em> function that runs before validation - if configured to.
To run coerce utilities before validation, pass the <code class="language-text">{ coerce: true }</code> option to
the <code class="language-text">validate</code> function.</p><div class="gatsby-code-title">index.ts</div><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// ...snipped for brevity...</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> admin<span class="token punctuation">]</span> <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> PersonSchema<span class="token punctuation">,</span> <span class="token punctuation">{</span> coerce<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div><p>With the change above, and the program re-run, the output changes to the
following.</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">{ password: &#x27;?g4Lxx&#x27;, name: &#x27;admin&#x27; }</code></pre></div><p>It&#x27;s important to note, on successful validations, the <code class="language-text">validate</code> function will
return a reference to the original data object passed - changed and augmented by
Superstruct&#x27;s coercing functions.</p><h2>Complex Validation Rules</h2><p>Validation rules become complex in real-world applications. Let&#x27;s simulate a
more realistic scenario by introducing a <code class="language-text">role</code> property that&#x27;s limited to a set
of values, a <code class="language-text">repeatPassword</code> that must match <code class="language-text">password</code> (if <code class="language-text">password</code> exists)
and a <code class="language-text">token</code> field that has a mutually exclusive relationship to <code class="language-text">password</code> and
<code class="language-text">repeatPassword</code>.</p><div class="gatsby-code-title">index.ts</div><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ss <span class="token keyword">from</span> <span class="token string">&#x27;superstruct&#x27;</span>

<span class="token keyword">enum</span> Roles <span class="token punctuation">{</span>
  <span class="token constant">USER</span> <span class="token operator">=</span> <span class="token string">&#x27;USER&#x27;</span><span class="token punctuation">,</span>
  <span class="token constant">ADMIN</span> <span class="token operator">=</span> <span class="token string">&#x27;ADMIN&#x27;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">alphanum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ss<span class="token punctuation">.</span><span class="token function">pattern</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[a-zA-Z0-9]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">password</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ss<span class="token punctuation">.</span><span class="token function">pattern</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-zA-Z0-9*:?]{3,6}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>

<span class="token keyword">const</span> BaseSchema <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">defaulted</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token function">alphanum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#x27;admin&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  role<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">defaulted</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">enums</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Roles<span class="token punctuation">.</span><span class="token constant">USER</span><span class="token punctuation">,</span> Roles<span class="token punctuation">.</span><span class="token constant">ADMIN</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Roles<span class="token punctuation">.</span><span class="token constant">ADMIN</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  token<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span><span class="token punctuation">[</span>ss<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ss<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  repeatPassword<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ...snipped for brevity...</span></code></pre></div><p>The first addition above is the <code class="language-text">enum</code> constants definition to represent valid
roles. I use the Superstruct <code class="language-text">enums</code> utility to list valid values and also pass
it a default value - implicitly making <code class="language-text">role</code> optional.</p><p>Next, I added the optional <code class="language-text">token</code> field that can be a number or a string and I
added the <code class="language-text">repeatPassword</code> field that must conform to the custom password
validation function.</p><p>Take note that all schema fields are now optional - some marked explicitly,
others implicitly set by the <code class="language-text">defaulted</code> utility. This will simplify our data
object typing later.</p><p>Also notice I renamed the schema as <code class="language-text">BaseSchema</code>. We need <code class="language-text">BaseSchema</code> as a
starting point for one more composition step to build the <code class="language-text">token</code>, <code class="language-text">password</code>
and <code class="language-text">repeatPassword</code> conditional validations. The <code class="language-text">PersonSchema</code> will be the
resultant schema of all composition steps.</p><div class="gatsby-code-title">index.ts</div><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ss <span class="token keyword">from</span> <span class="token string">&#x27;superstruct&#x27;</span>

<span class="token keyword">enum</span> Roles <span class="token punctuation">{</span>
  <span class="token constant">USER</span> <span class="token operator">=</span> <span class="token string">&#x27;USER&#x27;</span><span class="token punctuation">,</span>
  <span class="token constant">ADMIN</span> <span class="token operator">=</span> <span class="token string">&#x27;ADMIN&#x27;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">alphanum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ss<span class="token punctuation">.</span><span class="token function">pattern</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[a-zA-Z0-9]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">password</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ss<span class="token punctuation">.</span><span class="token function">pattern</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[a-zA-Z0-9*:?]{3,6}$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>

<span class="token keyword">const</span> BaseSchema <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">defaulted</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token function">alphanum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#x27;admin&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  role<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">defaulted</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">enums</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Roles<span class="token punctuation">.</span><span class="token constant">USER</span><span class="token punctuation">,</span> Roles<span class="token punctuation">.</span><span class="token constant">ADMIN</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Roles<span class="token punctuation">.</span><span class="token constant">ADMIN</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  token<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span><span class="token punctuation">[</span>ss<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ss<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  repeatPassword<span class="token operator">:</span> ss<span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> PersonSchema <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  ss<span class="token punctuation">.</span><span class="token function">refine</span><span class="token punctuation">(</span>BaseSchema<span class="token punctuation">,</span> <span class="token string">&#x27;PasswordOrToken&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>schema<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    schema<span class="token punctuation">.</span>password <span class="token operator">||</span> schema<span class="token punctuation">.</span>repeatPassword
      <span class="token operator">?</span> <span class="token operator">!</span><span class="token operator">!</span>schema<span class="token punctuation">.</span>token
        <span class="token operator">?</span> <span class="token boolean">false</span>
        <span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>schema<span class="token punctuation">.</span>token
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  ss<span class="token punctuation">.</span><span class="token function">refine</span><span class="token punctuation">(</span>
    BaseSchema<span class="token punctuation">,</span>
    <span class="token string">&#x27;PasswordMatch&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span>schema<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> schema<span class="token punctuation">.</span>password <span class="token operator">===</span> schema<span class="token punctuation">.</span>repeatPassword
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// ...snipped for brevity...</span></code></pre></div><p>The <code class="language-text">intersection</code> type annotation accepts an array of schemas, where each one
must pass validation. The first schema passed to <code class="language-text">intersection</code> is a refinement
of <code class="language-text">BaseSchema</code> via the Superstruct <code class="language-text">refine</code> utility. It validates the mutual
exclusion relationship of <code class="language-text">token</code> to <code class="language-text">password</code> and <code class="language-text">repeatPassword</code>. The second
refinement schema validates whether <code class="language-text">password</code> matches <code class="language-text">repeatPassword</code>.</p><p>With our <code class="language-text">PersonSchema</code> complete, we can expect the following validation results
(noted in comments) for these data object scenarios.</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// `Partial` makes all properties optional. This matches PersonSchema.</span>
<span class="token keyword">let</span> person<span class="token operator">:</span> Partial<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span>

person <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// fails. token must exist.</span>
person <span class="token operator">=</span> <span class="token punctuation">{</span> token<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span> <span class="token comment">// passes.</span>
person <span class="token operator">=</span> <span class="token punctuation">{</span> token<span class="token operator">:</span> <span class="token string">&#x27;abc&#x27;</span> <span class="token punctuation">}</span> <span class="token comment">// passes.</span>
person <span class="token operator">=</span> <span class="token punctuation">{</span> token<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> password<span class="token operator">:</span> <span class="token string">&#x27;?xp&#x27;</span> <span class="token punctuation">}</span> <span class="token comment">// fails. token or password.</span>
person <span class="token operator">=</span> <span class="token punctuation">{</span> token<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> repeatPassword<span class="token operator">:</span> <span class="token string">&#x27;?xp&#x27;</span> <span class="token punctuation">}</span> <span class="token comment">// fails. token or password.</span>
person <span class="token operator">=</span> <span class="token punctuation">{</span> password<span class="token operator">:</span> <span class="token string">&#x27;?xp&#x27;</span> <span class="token punctuation">}</span> <span class="token comment">// fails. passwords don&#x27;t match.</span>
person <span class="token operator">=</span> <span class="token punctuation">{</span> password<span class="token operator">:</span> <span class="token string">&#x27;?xp&#x27;</span><span class="token punctuation">,</span> repeatPassword<span class="token operator">:</span> <span class="token string">&#x27;?xp&#x27;</span> <span class="token punctuation">}</span> <span class="token comment">// passes.</span></code></pre></div><h2>Custom Error Handling</h2><p>If an error occurs during a base type (e.g. string, number, etc) validation
failure, Superstruct throws a clear and helpful error message. Here&#x27;s an
example:</p><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ss <span class="token keyword">from</span> <span class="token string">&#x27;superstruct&#x27;</span>
ss<span class="token punctuation">.</span><span class="token function">assert</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> ss<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div><p>The code above fails validation and throws the following error message.</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">StructError: Expected a string, but received: 4</code></pre></div><p>When our refinement validations fail, the error message is far from helpful.</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">StructError: Expected a value of type `object`, but received: `[object Object]`</code></pre></div><p>If we log our last error to the console, the Superstruct error object tells us
the specific refinement schema that failed validation.</p><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">StructError: Expected a value of type `object`, but received: `[object Object]`
  value: {
    token: 4,
    password: &#x27;xxxx&#x27;,
    name: &#x27;admin&#x27;,
    role: &#x27;ADMIN&#x27;,
    repeatPassword: undefined
  },
  type: &#x27;object&#x27;,
  refinement: &#x27;PasswordOrToken&#x27;,
  key: undefined,
  path: [],
  branch: [
    {
      token: 4,
      password: &#x27;xxxx&#x27;,
      name: &#x27;admin&#x27;,
      role: &#x27;ADMIN&#x27;,
      repeatPassword: undefined
    }
  ],
  failures: [Function (anonymous)]
}</code></pre></div><p>Using the <code class="language-text">refinement</code> property of the error object, we can customize error
messages and decide to throw an error, report a warning or continue execution on
a different path.</p><p>Here&#x27;s a snippet of how we&#x27;ll handle these errors.</p><div class="gatsby-code-title">index.ts</div><div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// ...snipped for brevity...</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> admin<span class="token punctuation">]</span> <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> PersonSchema<span class="token punctuation">,</span> <span class="token punctuation">{</span> coerce<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>refinement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#x27;PasswordOrToken&#x27;</span><span class="token operator">:</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Please provide a &#x27;password&#x27; or &#x27;token&#x27;; not both</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token string">&#x27;PasswordMatch&#x27;</span><span class="token operator">:</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Passwords must match</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> error
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>admin<span class="token punctuation">)</span></code></pre></div><h2>Summary</h2><p>In this post I covered data validation using Superstruct for simple data types,
like strings and numbers. I showed how to compose Superstruct utilities to
create slightly more complex validation schemas - in particular the <code class="language-text">alphanum</code>
and <code class="language-text">password</code> helpers.</p><p>Next, I provided examples for setting defaults and limiting a value to a defined
list of constants via the <code class="language-text">enums</code> utility. Then we jumped into the advanced
validation rules, with conditional dependency, and mutual exclusion.</p><p>The last section demonstrated custom error handling logic for those deeply
nested refinement schemas.</p><p>I hope you found this post useful. Check out the
<a href="https://github.com/dtjv/blog-demos/tree/main/data-validation-with-superstruct">source code</a>
on Github to see the complete example.</p><p>Thanks for reading.</p></div></article></div></main><footer><div class="py-8 sm:py-10 "><div class="flex items-center justify-center"><a href="mailto:davidtjvalles@gmail.com"><svg class="text-email w-6 h-6 ml-3 text-color-800 hover:text-blue-400" role="img" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Email</title><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg></a><a href="https://twitter.com/davidtjvalles"><svg class="text-twitter w-6 h-6 ml-3 text-color-800 hover:text-blue-400" role="img" fill="currentColor" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></a></div></div></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/data-validation-with-superstruct/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-cfb49261663188ed5fb5.js"],"app":["/app-cc3205a19653bf75719c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-b1aa8ab817ce1541b6a5.js"],"component---src-pages-index-js":["/component---src-pages-index-js-87ca376cc7772f3329e6.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-f884fdaf3b665afa7e75.js"],"component---src-templates-post-js":["/component---src-templates-post-js-d78a8d412a346317d064.js"]};/*]]>*/</script><script src="/polyfill-cfb49261663188ed5fb5.js" nomodule=""></script><script src="/component---src-templates-post-js-d78a8d412a346317d064.js" async=""></script><script src="/commons-15d545375be859768d92.js" async=""></script><script src="/app-cc3205a19653bf75719c.js" async=""></script><script src="/framework-fea831110b03277f031d.js" async=""></script><script src="/webpack-runtime-e71aa90cd4d05079cfbc.js" async=""></script></body></html>